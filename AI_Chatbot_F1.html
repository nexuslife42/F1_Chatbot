<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relief Fund AI Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-bubble-user {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .chat-bubble-bot {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
        }
        .dot-flashing {
            position: relative;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #4b5563; /* gray-600 */
            color: #4b5563; /* gray-600 */
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: .5s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: '';
            display: inline-block;
            position: absolute;
            top: 0;
        }
        .dot-flashing::before {
            left: -15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #4b5563; /* gray-600 */
            color: #4b5563; /* gray-600 */
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #4b5563; /* gray-600 */
            color: #4b5563; /* gray-600 */
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 1s;
        }

        @keyframes dotFlashing {
            0% {
                background-color: #4b5563; /* gray-600 */
            }
            50%, 100% {
                background-color: #d1d5db; /* gray-300 */
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">

    <div class="w-full max-w-2xl h-[90vh] flex flex-col bg-white rounded-2xl shadow-2xl">

        <!-- API Key Input Section has been removed. The chat is now displayed directly. -->


        <!-- Chat Container -->
        <div id="chat-container" class="w-full h-full flex flex-col bg-white rounded-2xl">
            <!-- Header -->
            <div class="p-4 border-b border-gray-200 rounded-t-2xl bg-white sticky top-0">
                <h1 class="text-2xl font-bold text-gray-800 text-center">Formula Fantasy One Chatbot</h1>
                <p class="text-sm text-gray-500 text-center">Ask anything about your remaining picks for the 2025 season</p>
            </div>

            <!-- Chat Window -->
            <div id="chat-window" class="flex-1 p-6 overflow-y-auto">
                <!-- Messages will be injected here -->
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="hidden p-6 pt-0">
                <div class="flex items-start gap-3 my-4">
                     <div class="flex items-center justify-center w-12 h-12 rounded-full bg-gray-200 flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    </div>
                    <div class="chat-bubble-bot p-4 rounded-lg max-w-lg">
                        <div class="dot-flashing"></div>
                    </div>
                </div>
            </div>

            <!-- Input Form -->
            <div class="p-4 border-t border-gray-200 bg-white rounded-b-2xl">
                <form id="chat-form" class="flex items-center space-x-3">
                    <input type="text" id="chat-input" placeholder="Type your question here..." class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                    <button type="submit" class="bg-blue-500 text-white font-semibold py-3 px-5 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const chatContainer = document.getElementById('chat-container');
        const chatWindow = document.getElementById('chat-window');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const loadingIndicator = document.getElementById('loading-indicator');

        // App State
        const geminiApiKey = "AIzaSyBcd-RuoNlr31da1haSEDQ53OW8OHh48pI"; // <-- GEMINI API KEY
        let conversationHistory = [];

        // This is the knowledge base extracted from your uploaded documents.
        const knowledgeBase = `
                    DOCUMENT 1: Ed Bryant
        ---
        This document provides the remaining picks for Ed Bryant in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 2
        - Mclaren: 0
        - Red Bull: 3
        - Mercedes: 8
        - Aston Martin: 9
        - Alpine: 5
        - Williams: 0
        - Racing Bulls: 0
        - Kick Sauber: 4
        - Haas: 3
        - Max Verstappen: 0
        - Liam Lawson: 4
        - Yuki Tsunoda: 6
        - Charles Leclerc: 0
        - Lewis Hamilton: 2
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 4
        - Andrea Kimi Antonelli: 7
        - Fernando Alonso: 7
        - Lance Stroll: 8
        - Pierre Gasly: 4
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 4
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 1
        - Gabriel Bortoleto: 5
        - Franco Colapinto: 5
        

        DOCUMENT 2: Guy Mouton
        ---
        This document provides the remaining picks for Guy Mouton in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 2
        - Mclaren: 0
        - Red Bull: 5
        - Mercedes: 5
        - Aston Martin: 8
        - Alpine: 5
        - Williams: 0
        - Racing Bulls: 0
        - Kick Sauber: 2
        - Haas: 3
        - Max Verstappen: 0
        - Liam Lawson: 5
        - Yuki Tsunoda: 5
        - Charles Leclerc: 1
        - Lewis Hamilton: 4
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 1
        - Andrea Kimi Antonelli: 8
        - Fernando Alonso: 6
        - Lance Stroll: 8
        - Pierre Gasly: 5
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 3
        - Oliver Bearman: 3
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 3: Jonathan Cummins
        ---
        This document provides the remaining picks for Jonathan Cummins in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 6
        - Mclaren: 0
        - Red Bull: 8
        - Mercedes: 0
        - Aston Martin: 6
        - Alpine: 2
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 3
        - Max Verstappen: 2
        - Liam Lawson: 2
        - Yuki Tsunoda: 7
        - Charles Leclerc: 3
        - Lewis Hamilton: 5
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 0
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 5
        - Lance Stroll: 7
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 5
        - Oliver Bearman: 5
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 3
        - Franco Colapinto: 4
        

        DOCUMENT 4: Mark Corley
        ---
        This document provides the remaining picks for Mark Corley in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 2
        - Mclaren: 0
        - Red Bull: 4
        - Mercedes: 5
        - Aston Martin: 9
        - Alpine: 2
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 3
        - Max Verstappen: 0
        - Liam Lawson: 7
        - Yuki Tsunoda: 7
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 0
        - Andrea Kimi Antonelli: 7
        - Fernando Alonso: 7
        - Lance Stroll: 8
        - Pierre Gasly: 0
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 1
        - Oliver Bearman: 5
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 5
        - Franco Colapinto: 4
        

        DOCUMENT 5: Will Stetson
        ---
        This document provides the remaining picks for Will Stetson in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 0
        - Mclaren: 0
        - Red Bull: 10
        - Mercedes: 10
        - Aston Martin: 10
        - Alpine: 5
        - Williams: 5
        - Racing Bulls: 5
        - Kick Sauber: 5
        - Haas: 0
        - Max Verstappen: 8
        - Liam Lawson: 8
        - Yuki Tsunoda: 8
        - Charles Leclerc: 8
        - Lewis Hamilton: 0
        - Lando Norris: 0
        - Oscar Piastri: 8
        - George Russell: 0
        - Andrea Kimi Antonelli: 8
        - Fernando Alonso: 8
        - Lance Stroll: 8
        - Pierre Gasly: 0
        - Jack Doohan: 5
        - Isack Hadjar: 5
        - Esteban Ocon: 5
        - Oliver Bearman: 5
        - Alex Albon: 5
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 5
        - Gabriel Bortoleto: 5
        - Franco Colapinto: 5
        

        DOCUMENT 6: Phil Root
        ---
        This document provides the remaining picks for Phil Root in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 0
        - Red Bull: 6
        - Mercedes: 2
        - Aston Martin: 9
        - Alpine: 3
        - Williams: 2
        - Racing Bulls: 0
        - Kick Sauber: 1
        - Haas: 4
        - Max Verstappen: 1
        - Liam Lawson: 5
        - Yuki Tsunoda: 6
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 1
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 3
        - Fernando Alonso: 8
        - Lance Stroll: 8
        - Pierre Gasly: 1
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 5
        - Oliver Bearman: 4
        - Alex Albon: 0
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 1
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 3
        

        DOCUMENT 7: Mike Merritt
        ---
        This document provides the remaining picks for Mike Merritt in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 0
        - Red Bull: 6
        - Mercedes: 3
        - Aston Martin: 8
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 0
        - Kick Sauber: 2
        - Haas: 5
        - Max Verstappen: 0
        - Liam Lawson: 2
        - Yuki Tsunoda: 8
        - Charles Leclerc: 0
        - Lewis Hamilton: 5
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 1
        - Andrea Kimi Antonelli: 7
        - Fernando Alonso: 6
        - Lance Stroll: 8
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 5
        - Oliver Bearman: 3
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 3
        - Franco Colapinto: 5
        

        DOCUMENT 8: (Bernie) John McKenna Sr
        ---
        This document provides the remaining picks for (Bernie) John McKenna Sr in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 1
        - Red Bull: 5
        - Mercedes: 4
        - Aston Martin: 7
        - Alpine: 3
        - Williams: 1
        - Racing Bulls: 1
        - Kick Sauber: 0
        - Haas: 5
        - Max Verstappen: 4
        - Liam Lawson: 5
        - Yuki Tsunoda: 4
        - Charles Leclerc: 2
        - Lewis Hamilton: 4
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 3
        - Andrea Kimi Antonelli: 4
        - Fernando Alonso: 4
        - Lance Stroll: 8
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 4
        - Oliver Bearman: 3
        - Alex Albon: 3
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 1
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 9: Chris Johnson
        ---
        This document provides the remaining picks for Chris Johnson in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 4
        - Mclaren: 1
        - Red Bull: 4
        - Mercedes: 4
        - Aston Martin: 7
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 1
        - Kick Sauber: 1
        - Haas: 4
        - Max Verstappen: 0
        - Liam Lawson: 2
        - Yuki Tsunoda: 7
        - Charles Leclerc: 4
        - Lewis Hamilton: 4
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 5
        - Lance Stroll: 6
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 4
        - Oliver Bearman: 4
        - Alex Albon: 0
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 10: Cully
        ---
        This document provides the remaining picks for Cully in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 0
        - Red Bull: 3
        - Mercedes: 6
        - Aston Martin: 8
        - Alpine: 4
        - Williams: 1
        - Racing Bulls: 1
        - Kick Sauber: 2
        - Haas: 2
        - Max Verstappen: 0
        - Liam Lawson: 3
        - Yuki Tsunoda: 7
        - Charles Leclerc: 3
        - Lewis Hamilton: 2
        - Lando Norris: 1
        - Oscar Piastri: 1
        - George Russell: 2
        - Andrea Kimi Antonelli: 6
        - Fernando Alonso: 6
        - Lance Stroll: 6
        - Pierre Gasly: 4
        - Jack Doohan: 5
        - Isack Hadjar: 2
        - Esteban Ocon: 3
        - Oliver Bearman: 3
        - Alex Albon: 1
        - Carlos Sainz Jr.: 2
        - Nico Hulkenberg: 0
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 11: Kurt Mouton
        ---
        This document provides the remaining picks for Kurt Mouton in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 4
        - Mclaren: 1
        - Red Bull: 5
        - Mercedes: 5
        - Aston Martin: 5
        - Alpine: 2
        - Williams: 1
        - Racing Bulls: 1
        - Kick Sauber: 4
        - Haas: 2
        - Max Verstappen: 2
        - Liam Lawson: 3
        - Yuki Tsunoda: 6
        - Charles Leclerc: 4
        - Lewis Hamilton: 4
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 4
        - Andrea Kimi Antonelli: 4
        - Fernando Alonso: 3
        - Lance Stroll: 7
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 0
        - Oliver Bearman: 4
        - Alex Albon: 3
        - Carlos Sainz Jr.: 2
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 1
        - Franco Colapinto: 5
        

        DOCUMENT 12: Tony Androsky
        ---
        This document provides the remaining picks for Tony Androsky in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 5
        - Mclaren: 1
        - Red Bull: 5
        - Mercedes: 3
        - Aston Martin: 6
        - Alpine: 3
        - Williams: 1
        - Racing Bulls: 2
        - Kick Sauber: 2
        - Haas: 2
        - Max Verstappen: 2
        - Liam Lawson: 5
        - Yuki Tsunoda: 8
        - Charles Leclerc: 2
        - Lewis Hamilton: 5
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 2
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 5
        - Lance Stroll: 6
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 3
        - Oliver Bearman: 4
        - Alex Albon: 0
        - Carlos Sainz Jr.: 2
        - Nico Hulkenberg: 1
        - Gabriel Bortoleto: 3
        - Franco Colapinto: 4
        

        DOCUMENT 13: Chris DeLizza
        ---
        This document provides the remaining picks for Chris DeLizza in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 2
        - Mclaren: 1
        - Red Bull: 3
        - Mercedes: 6
        - Aston Martin: 8
        - Alpine: 5
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 1
        - Haas: 2
        - Max Verstappen: 0
        - Liam Lawson: 5
        - Yuki Tsunoda: 8
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 2
        - Oscar Piastri: 1
        - George Russell: 3
        - Andrea Kimi Antonelli: 6
        - Fernando Alonso: 5
        - Lance Stroll: 6
        - Pierre Gasly: 3
        - Jack Doohan: 4
        - Isack Hadjar: 4
        - Esteban Ocon: 2
        - Oliver Bearman: 0
        - Alex Albon: 1
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 3
        - Franco Colapinto: 4
        

        DOCUMENT 14: Bob DeLizza
        ---
        This document provides the remaining picks for Bob DeLizza in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 5
        - Mercedes: 4
        - Aston Martin: 6
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 2
        - Max Verstappen: 1
        - Liam Lawson: 5
        - Yuki Tsunoda: 7
        - Charles Leclerc: 3
        - Lewis Hamilton: 2
        - Lando Norris: 1
        - Oscar Piastri: 1
        - George Russell: 2
        - Andrea Kimi Antonelli: 6
        - Fernando Alonso: 5
        - Lance Stroll: 6
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 4
        - Esteban Ocon: 3
        - Oliver Bearman: 0
        - Alex Albon: 1
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 1
        - Franco Colapinto: 4
        

        DOCUMENT 15: Carsten Bick
        ---
        This document provides the remaining picks for Carsten Bick in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 4
        - Mclaren: 1
        - Red Bull: 5
        - Mercedes: 4
        - Aston Martin: 6
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 1
        - Kick Sauber: 3
        - Haas: 4
        - Max Verstappen: 3
        - Liam Lawson: 5
        - Yuki Tsunoda: 4
        - Charles Leclerc: 3
        - Lewis Hamilton: 3
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 4
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 4
        - Lance Stroll: 7
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 2
        - Alex Albon: 1
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 1
        - Gabriel Bortoleto: 4
        - Franco Colapinto: 5
        

        DOCUMENT 16: Christian Margetson
        ---
        This document provides the remaining picks for Christian Margetson in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 4
        - Mercedes: 5
        - Aston Martin: 6
        - Alpine: 2
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 4
        - Haas: 3
        - Max Verstappen: 2
        - Liam Lawson: 6
        - Yuki Tsunoda: 7
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 5
        - Lance Stroll: 6
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 3
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 4
        - Franco Colapinto: 5
        

        DOCUMENT 17: Daniel George
        ---
        This document provides the remaining picks for Daniel George in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 3
        - Mercedes: 4
        - Aston Martin: 8
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 2
        - Haas: 2
        - Max Verstappen: 0
        - Liam Lawson: 6
        - Yuki Tsunoda: 6
        - Charles Leclerc: 2
        - Lewis Hamilton: 4
        - Lando Norris: 2
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 6
        - Pierre Gasly: 4
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 3
        - Oliver Bearman: 2
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 18: Jamal Thomas
        ---
        This document provides the remaining picks for Jamal Thomas in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 6
        - Mclaren: 1
        - Red Bull: 3
        - Mercedes: 3
        - Aston Martin: 7
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 0
        - Kick Sauber: 4
        - Haas: 4
        - Max Verstappen: 0
        - Liam Lawson: 2
        - Yuki Tsunoda: 6
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 0
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 8
        - Fernando Alonso: 5
        - Lance Stroll: 7
        - Pierre Gasly: 1
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 4
        - Oliver Bearman: 4
        - Alex Albon: 1
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 19: Jeff Sexton
        ---
        This document provides the remaining picks for Jeff Sexton in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 2
        - Mclaren: 2
        - Red Bull: 3
        - Mercedes: 3
        - Aston Martin: 10
        - Alpine: 3
        - Williams: 3
        - Racing Bulls: 1
        - Kick Sauber: 2
        - Haas: 1
        - Max Verstappen: 0
        - Liam Lawson: 5
        - Yuki Tsunoda: 5
        - Charles Leclerc: 1
        - Lewis Hamilton: 1
        - Lando Norris: 1
        - Oscar Piastri: 3
        - George Russell: 1
        - Andrea Kimi Antonelli: 8
        - Fernando Alonso: 6
        - Lance Stroll: 8
        - Pierre Gasly: 0
        - Jack Doohan: 5
        - Isack Hadjar: 3
        - Esteban Ocon: 0
        - Oliver Bearman: 2
        - Alex Albon: 3
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 5
        - Franco Colapinto: 5
        

        DOCUMENT 20: Spencer McKenna
        ---
        This document provides the remaining picks for Spencer McKenna in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 4
        - Mclaren: 2
        - Red Bull: 6
        - Mercedes: 0
        - Aston Martin: 8
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 1
        - Max Verstappen: 5
        - Liam Lawson: 6
        - Yuki Tsunoda: 6
        - Charles Leclerc: 2
        - Lewis Hamilton: 2
        - Lando Norris: 1
        - Oscar Piastri: 0
        - George Russell: 1
        - Andrea Kimi Antonelli: 4
        - Fernando Alonso: 6
        - Lance Stroll: 8
        - Pierre Gasly: 4
        - Jack Doohan: 4
        - Isack Hadjar: 2
        - Esteban Ocon: 1
        - Oliver Bearman: 1
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 3
        - Gabriel Bortoleto: 3
        - Franco Colapinto: 5
        

        DOCUMENT 21: David Taylor
        ---
        This document provides the remaining picks for David Taylor in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 5
        - Mclaren: 2
        - Red Bull: 3
        - Mercedes: 5
        - Aston Martin: 5
        - Alpine: 1
        - Williams: 1
        - Racing Bulls: 3
        - Kick Sauber: 3
        - Haas: 2
        - Max Verstappen: 0
        - Liam Lawson: 7
        - Yuki Tsunoda: 8
        - Charles Leclerc: 3
        - Lewis Hamilton: 3
        - Lando Norris: 1
        - Oscar Piastri: 1
        - George Russell: 1
        - Andrea Kimi Antonelli: 4
        - Fernando Alonso: 7
        - Lance Stroll: 7
        - Pierre Gasly: 0
        - Jack Doohan: 5
        - Isack Hadjar: 5
        - Esteban Ocon: 2
        - Oliver Bearman: 1
        - Alex Albon: 1
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 0
        - Gabriel Bortoleto: 3
        - Franco Colapinto: 5
        

        DOCUMENT 22: Jeff Richter
        ---
        This document provides the remaining picks for Jeff Richter in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 3
        - Red Bull: 5
        - Mercedes: 4
        - Aston Martin: 5
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 1
        - Haas: 3
        - Max Verstappen: 3
        - Liam Lawson: 7
        - Yuki Tsunoda: 4
        - Charles Leclerc: 0
        - Lewis Hamilton: 2
        - Lando Norris: 4
        - Oscar Piastri: 1
        - George Russell: 3
        - Andrea Kimi Antonelli: 6
        - Fernando Alonso: 3
        - Lance Stroll: 7
        - Pierre Gasly: 4
        - Jack Doohan: 5
        - Isack Hadjar: 2
        - Esteban Ocon: 3
        - Oliver Bearman: 3
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 1
        - Gabriel Bortoleto: 1
        - Franco Colapinto: 4
        

        DOCUMENT 23: John Hunter Houser
        ---
        This document provides the remaining picks for John Hunter Houser in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 0
        - Mclaren: 3
        - Red Bull: 7
        - Mercedes: 2
        - Aston Martin: 8
        - Alpine: 3
        - Williams: 3
        - Racing Bulls: 2
        - Kick Sauber: 2
        - Haas: 0
        - Max Verstappen: 1
        - Liam Lawson: 5
        - Yuki Tsunoda: 5
        - Charles Leclerc: 1
        - Lewis Hamilton: 3
        - Lando Norris: 2
        - Oscar Piastri: 3
        - George Russell: 2
        - Andrea Kimi Antonelli: 6
        - Fernando Alonso: 6
        - Lance Stroll: 5
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 0
        - Oliver Bearman: 3
        - Alex Albon: 3
        - Carlos Sainz Jr.: 3
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 1
        - Franco Colapinto: 4
        

        DOCUMENT 24: Jonathan Mayberry
        ---
        This document provides the remaining picks for Jonathan Mayberry in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 3
        - Red Bull: 4
        - Mercedes: 3
        - Aston Martin: 8
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 1
        - Max Verstappen: 1
        - Liam Lawson: 6
        - Yuki Tsunoda: 8
        - Charles Leclerc: 1
        - Lewis Hamilton: 5
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 2
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 0
        - Alex Albon: 1
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 0
        - Gabriel Bortoleto: 4
        - Franco Colapinto: 5
        

        DOCUMENT 25: Mark Jobson
        ---
        This document provides the remaining picks for Mark Jobson in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 5
        - Mclaren: 3
        - Red Bull: 4
        - Mercedes: 3
        - Aston Martin: 5
        - Alpine: 2
        - Williams: 0
        - Racing Bulls: 1
        - Kick Sauber: 4
        - Haas: 3
        - Max Verstappen: 0
        - Liam Lawson: 4
        - Yuki Tsunoda: 7
        - Charles Leclerc: 3
        - Lewis Hamilton: 3
        - Lando Norris: 1
        - Oscar Piastri: 1
        - George Russell: 1
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 8
        - Pierre Gasly: 4
        - Jack Doohan: 5
        - Isack Hadjar: 2
        - Esteban Ocon: 1
        - Oliver Bearman: 2
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 4
        - Gabriel Bortoleto: 4
        - Franco Colapinto: 2
        

        DOCUMENT 26: William Roland
        ---
        This document provides the remaining picks for William Roland in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 3
        - Red Bull: 10
        - Mercedes: 10
        - Aston Martin: 10
        - Alpine: 5
        - Williams: 0
        - Racing Bulls: 5
        - Kick Sauber: 5
        - Haas: 5
        - Max Verstappen: 8
        - Liam Lawson: 8
        - Yuki Tsunoda: 1
        - Charles Leclerc: 1
        - Lewis Hamilton: 8
        - Lando Norris: 1
        - Oscar Piastri: 8
        - George Russell: 8
        - Andrea Kimi Antonelli: 8
        - Fernando Alonso: 5
        - Lance Stroll: 5
        - Pierre Gasly: 5
        - Jack Doohan: 5
        - Isack Hadjar: 5
        - Esteban Ocon: 0
        - Oliver Bearman: 5
        - Alex Albon: 5
        - Carlos Sainz Jr.: 5
        - Nico Hulkenberg: 5
        - Gabriel Bortoleto: 5
        - Franco Colapinto: 5
        

        DOCUMENT 27: William Jones
        ---
        This document provides the remaining picks for William Jones in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 4
        - Mercedes: 3
        - Aston Martin: 8
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 2
        - Haas: 2
        - Max Verstappen: 0
        - Liam Lawson: 5
        - Yuki Tsunoda: 5
        - Charles Leclerc: 1
        - Lewis Hamilton: 4
        - Lando Norris: 1
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 4
        - Fernando Alonso: 6
        - Lance Stroll: 6
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 2
        - Alex Albon: 0
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 28: Scott Schaffer
        ---
        This document provides the remaining picks for Scott Schaffer in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 3
        - Red Bull: 4
        - Mercedes: 3
        - Aston Martin: 8
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 2
        - Haas: 1
        - Max Verstappen: 2
        - Liam Lawson: 6
        - Yuki Tsunoda: 8
        - Charles Leclerc: 1
        - Lewis Hamilton: 5
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 2
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 0
        - Alex Albon: 1
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 0
        - Gabriel Bortoleto: 4
        - Franco Colapinto: 5
        

        DOCUMENT 29: Mike W
        ---
        This document provides the remaining picks for Mike W in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 3
        - Red Bull: 5
        - Mercedes: 5
        - Aston Martin: 7
        - Alpine: 2
        - Williams: 0
        - Racing Bulls: 0
        - Kick Sauber: 3
        - Haas: 3
        - Max Verstappen: 2
        - Liam Lawson: 4
        - Yuki Tsunoda: 7
        - Charles Leclerc: 2
        - Lewis Hamilton: 5
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 3
        - Andrea Kimi Antonelli: 6
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 0
        - Esteban Ocon: 4
        - Oliver Bearman: 4
        - Alex Albon: 1
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 1
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 30: John S
        ---
        This document provides the remaining picks for John S in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 4
        - Mclaren: 2
        - Red Bull: 3
        - Mercedes: 4
        - Aston Martin: 7
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 1
        - Kick Sauber: 3
        - Haas: 3
        - Max Verstappen: 0
        - Liam Lawson: 5
        - Yuki Tsunoda: 6
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 2
        - Esteban Ocon: 3
        - Oliver Bearman: 3
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 3
        - Franco Colapinto: 5
        

        DOCUMENT 31: William S
        ---
        This document provides the remaining picks for William S in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 1
        - Red Bull: 4
        - Mercedes: 4
        - Aston Martin: 7
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 1
        - Kick Sauber: 3
        - Haas: 3
        - Max Verstappen: 1
        - Liam Lawson: 5
        - Yuki Tsunoda: 6
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 3
        - Alex Albon: 1
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 32: Christopher M
        ---
        This document provides the remaining picks for Christopher M in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 3
        - Mercedes: 5
        - Aston Martin: 7
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 2
        - Max Verstappen: 0
        - Liam Lawson: 5
        - Yuki Tsunoda: 7
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 1
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 5
        - Lance Stroll: 7
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 2
        - Esteban Ocon: 3
        - Oliver Bearman: 2
        - Alex Albon: 1
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 33: Bob J
        ---
        This document provides the remaining picks for Bob J in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 3
        - Red Bull: 4
        - Mercedes: 3
        - Aston Martin: 8
        - Alpine: 4
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 1
        - Max Verstappen: 1
        - Liam Lawson: 6
        - Yuki Tsunoda: 8
        - Charles Leclerc: 1
        - Lewis Hamilton: 5
        - Lando Norris: 0
        - Oscar Piastri: 1
        - George Russell: 2
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 2
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 0
        - Alex Albon: 1
        - Carlos Sainz Jr.: 1
        - Nico Hulkenberg: 0
        - Gabriel Bortoleto: 4
        - Franco Colapinto: 5
        

        DOCUMENT 34: Michael R
        ---
        This document provides the remaining picks for Michael R in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 4
        - Mercedes: 5
        - Aston Martin: 8
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 2
        - Haas: 2
        - Max Verstappen: 1
        - Liam Lawson: 6
        - Yuki Tsunoda: 7
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 1
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 2
        - Oliver Bearman: 2
        - Alex Albon: 1
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 35: Jonathan M
        ---
        This document provides the remaining picks for Jonathan M in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 5
        - Mercedes: 4
        - Aston Martin: 7
        - Alpine: 2
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 3
        - Haas: 2
        - Max Verstappen: 2
        - Liam Lawson: 5
        - Yuki Tsunoda: 6
        - Charles Leclerc: 3
        - Lewis Hamilton: 3
        - Lando Norris: 1
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 6
        - Fernando Alonso: 5
        - Lance Stroll: 8
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 3
        - Oliver Bearman: 3
        - Alex Albon: 0
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5
        

        DOCUMENT 36: Scott M
        ---
        This document provides the remaining picks for Scott M in the F1 fantasy league.
        Picks Remaining:
        - Ferrari: 3
        - Mclaren: 2
        - Red Bull: 4
        - Mercedes: 4
        - Aston Martin: 8
        - Alpine: 3
        - Williams: 0
        - Racing Bulls: 2
        - Kick Sauber: 2
        - Haas: 3
        - Max Verstappen: 0
        - Liam Lawson: 6
        - Yuki Tsunoda: 6
        - Charles Leclerc: 2
        - Lewis Hamilton: 3
        - Lando Norris: 1
        - Oscar Piastri: 0
        - George Russell: 3
        - Andrea Kimi Antonelli: 5
        - Fernando Alonso: 6
        - Lance Stroll: 7
        - Pierre Gasly: 3
        - Jack Doohan: 5
        - Isack Hadjar: 1
        - Esteban Ocon: 2
        - Oliver Bearman: 2
        - Alex Albon: 1
        - Carlos Sainz Jr.: 0
        - Nico Hulkenberg: 2
        - Gabriel Bortoleto: 2
        - Franco Colapinto: 5

        `;

        // The system prompt that guides the AI's behavior.
        const systemPrompt = `
        You are a helpful and friendly AI assistant for participants in an F1 fantasy league. Your role is to answer questions about specific team principals and their remaining picks for drivers and constructors.

        Your knowledge is strictly limited to the information provided in the documents below. Do not use any external knowledge or make up information. If a question cannot be answered from the provided text, you must say, "I'm sorry, but I don't have information on that topic. My knowledge is limited to the provided list of team principals and their remaining picks."

        When answering, be clear and concise. If the user's question is about a specific team principal, focus your answer on that person. Provide a bulleted list for their remaining picks. If the question is general, you may mention or compare multiple team principals if relevant. Start your first message with a friendly greeting.
        `;

        // Function to start the chat application
        function startChat() {
            // apiKeySection is removed, so we just show the welcome message
            const welcomeMessage = "Hello! Welcome to the Formula Fantasy One League Chatbot. I'm here to help you with questions about your remaining picks for drivers and teams. How can I assist you today?";
            addMessage('bot', welcomeMessage);
            conversationHistory.push({ role: "model", parts: [{ text: welcomeMessage }] });
        }


        // Function to call the Gemini API
        async function getAIResponse(userQuery) {
            if (!geminiApiKey || geminiApiKey === "YOUR_API_KEY_HERE") {
                return "API Key not found. Please add your Gemini API key to the script in the HTML file.";
            }

            // Use the hardcoded API key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${geminiApiKey}`;

            // Combine system prompt, knowledge base, history, and new query
            const fullPrompt = `${knowledgeBase}\n\nConversation History:\n${conversationHistory.map(m => `${m.role}: ${m.parts[0].text}`).join('\n')}\n\nuser: ${userQuery}`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: fullPrompt }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("API Error:", errorData);
                    return `API request failed: ${errorData.error.message}. Please check your API key and network connection.`;
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                    console.error("Unexpected API response structure:", result);
                    return "I encountered an issue processing your request. Please try again.";
                }

            } catch (error) {
                console.error('Error fetching AI response:', error);
                return "I'm having trouble connecting to my knowledge base right now. Please check your connection or try again later.";
            }
        }

        // Function to add a message to the chat window
        function addMessage(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.className = `flex items-start gap-3 my-4 ${sender === 'user' ? 'justify-end' : ''}`;
            
            const sanitizedMessage = message.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const formattedMessage = sanitizedMessage.replace(/\n/g, '<br>');


            let bubbleContent = '';
            if (sender === 'bot') {
                bubbleContent = `
                    <div class="flex items-center justify-center w-12 h-12 rounded-full bg-gray-200 flex-shrink-0">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    </div>
                    <div class="chat-bubble-bot p-4 rounded-lg max-w-lg">
                        ${formattedMessage}
                    </div>
                `;
            } else {
                 bubbleContent = `
                    <div class="chat-bubble-user p-4 rounded-lg max-w-lg">
                        ${formattedMessage}
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-500 text-white flex-shrink-0">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    </div>
                 `;
            }

            messageElement.innerHTML = bubbleContent;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // Handle Chat Form Submission
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userInput = chatInput.value.trim();
            if (userInput === '') return;

            addMessage('user', userInput);
            chatInput.value = '';
            loadingIndicator.classList.remove('hidden');

            conversationHistory.push({ role: "user", parts: [{ text: userInput }] });

            const aiResponse = await getAIResponse(userInput);

            conversationHistory.push({ role: "model", parts: [{ text: aiResponse }] });
            
            if (conversationHistory.length > 10) {
                conversationHistory = conversationHistory.slice(-10);
            }

            loadingIndicator.classList.add('hidden');
            addMessage('bot', aiResponse);
        });
        
        // API Key form submission handler has been removed.

        // Initializer
        window.onload = () => {
            // Directly start the chat, no need to check for a key in storage.
            startChat();
        };

    </script>
</body>
</html>

